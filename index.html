<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ò–≥—Ä–∞: –°–º—ã—Å–ª –°–ª–æ–≤–∞</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="large-header" class="large-header">
  <canvas id="demo-canvas"></canvas>
</div>

<div class="container">
  <h1 class="main-title">
    –°–ú–´–°–õ ‚ú®<span class="thin">–°–õ–û–í–ê üåü</span>
  </h1>


  <div id="auth-screen" class="card">
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! üéâ</h2>
    <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É üôå</p>
    <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" maxlength="20"
           style="padding:12px; font-size:1.2em; width: 100%; max-width: 300px; border-radius: 8px; border: 2px solid var(--primary);">
  
    <button class="btn btn-large" onclick="startGame()">
      –ù–∞—á–∞—Ç—å –∏–≥—Ä—É üöÄ
    </button>
    <small style="color: rgba(255,255,255,0.6);">
      ‚Ñπ–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º—ã—à–∫—É –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π
    </small>
  </div>


  <div id="menu-screen" style="display:none;">

    <div class="side-panels">

      <div class="side-panel">
        <div class="card compact-card">
          <h3 style="margin-bottom: 15px;">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ ü•á</h3>
          <div id="mini-leaderboard">
            <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          </div>
          <button class="btn btn-small" onclick="window.location.href='leaderboard.html'" style="margin-top: 10px;">
            –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ üèÜ
          </button>
        </div>
      </div>


      <div class="main-panel">
        <div class="card">
          <div class="player-info">
            <div class="player-stats">
              <div class="stat-item">
                <span class="stat-label">–ò–≥—Ä–æ–∫ üë§:</span>
                <span id="welcome-text" class="stat-value"></span>
              </div>
              <div class="stat-item">
                <span class="stat-label">–û—á–∫–∏ ‚ú®:</span>
                <span id="score-text" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ üéØ:</span>
                <span id="completed-text" class="stat-value">0/3</span>
              </div>
            </div>
          </div>

          <h3 style="margin-top: 20px; margin-bottom: 15px;">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å üïπÔ∏è</h3>

          <div class="level-grid">
            <div id="lvl1" class="level-card" onclick="goTo(1)">
              <h3>–£—Ä–æ–≤–µ–Ω—å 1 üå±</h3>
              <p class="level-desc">–ü–∞—Ä—ã üîó</p>
              <div class="level-info">
                <small>90 —Å–µ–∫</small>
              </div>
              <div class="level-stats" id="stats-1"></div>
            </div>

            <div id="lvl2" class="level-card" onclick="goTo(2)">
              <h3>–£—Ä–æ–≤–µ–Ω—å 2 ‚ö°</h3>
              <p class="level-desc">–°–∫–æ—Ä–æ—Å—Ç—å üåÄ</p>
              <div class="level-info">
                <small>120 —Å–µ–∫</small>
              </div>
              <div class="level-stats" id="stats-2"></div>
            </div>

            <div id="lvl3" class="level-card" onclick="goTo(3)">
              <h3>–£—Ä–æ–≤–µ–Ω—å 3 üî•</h3>
              <p class="level-desc">–°–∫–æ—Ä–æ—Å—Ç—å üöÄ</p>
              <div class="level-info">
                <small>120 —Å–µ–∫</small>
              </div>
              <div class="level-stats" id="stats-3"></div>
            </div>
          </div>

          <div style="margin-top: 20px;">
            <button class="btn" style="background:#e17055" onclick="resetProgress()">
              –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å ‚ôªÔ∏è
            </button>
            <button class="btn" style="background:#d63031" onclick="UserManager.logout()">
              –°–º–µ–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞ üîÑ
            </button>
          </div>
        </div>
      </div>


      <div class="side-panel">
        <div class="card compact-card">
          <h3 style="margin-bottom: 15px;">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å üé≤</h3>
          <div class="how-to-play">
            <div class="instruction-item">
              <p>1 —É—Ä–æ–≤–µ–Ω—å: –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–µ —Å–ª–æ–≤–∞ –∏–∑ –∫—Ä—É–∂–∫–æ–≤ –≤ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ª–æ–≤–∞–º –≤–Ω—É—Ç—Ä–∏. üß†</p>
            </div>
            <div class="instruction-item">
              <p>–£—Ä–æ–≤–µ–Ω—å 2: –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–µ —Å–ª–æ–≤–∞ –≤ –Ω—É–∂–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –Ω–æ —Ç–µ–ø–µ—Ä—å —Å–ª–æ–≤–∞ –ø–∞–¥–∞—é—Ç! ‚ö°</p>
            </div>
            <div class="instruction-item">
              <p>–£—Ä–æ–≤–µ–Ω—å 3: –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–µ –ø–∞–¥–∞—é—â–∏–µ —Å–ª–æ–≤–∞ –≤ –Ω—É–∂–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –Ω–æ —Ç–µ–ø–µ—Ä—å —ç—Ç–æ —Å–ª–æ–∂–Ω–µ–µ –Ω–∞–º–Ω–æ–≥–æ! üí•</p>
            </div>
            <div class="instruction-item">
              <p>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ –≤—Ä–µ–º—è! ‚è≥</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer style="text-align: center; margin-top: 20px; opacity: 0.6; font-size: 0.9em;">
    <p>–°–¥–µ–ª–∞–Ω–æ —Å ‚ô• –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ–º ‚ú®</p>
    <p>[TOP SECRET] –ê-–î-–ú-–ò-–ù</p>
  </footer>
</div>

<script src="script.js"></script>
<script>
    function startGame() {
        const nameInput = document.getElementById('nameInput');
        const name = nameInput.value.trim();

        if (!name || name.length === 0) {
            nameInput.style.borderColor = '#d63031';
            nameInput.style.animation = 'shake 0.5s';
            setTimeout(() => {
                nameInput.style.borderColor = '';
                nameInput.style.animation = '';
            }, 500);
            NotificationManager.show("‚ö† –í–≤–µ–¥–∏—Ç–µ –∏–º—è!", 'error');
            return;
        }

        UserManager.login(name);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const nameInput = document.getElementById('nameInput');
        if (nameInput) {
            nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    startGame();
                }
            });
            nameInput.focus();
        }

        // –°–µ–∫—Ä–µ—Ç–Ω—ã–µ "–∫–æ–¥—ã" –¥–ª—è –≤—ã–¥–∞—á–∏ –∞–¥–º–∏–Ω–∫–∏ (–Ω–∞–±–∏—Ä–∞—é—Ç—Å—è —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ–¥—Ä—è–¥)
        const adminTriggers = [
            'admin', '–∞–¥–º–∏–Ω',
            'vip', '–≤–∏–ø',
            'god', '–≥–æ–¥',
            'bog', '–±–æ–≥',
            'test', '—Ç–µ—Å—Ç',
            'root', '—Ä—É—Ç',
            'dev', '–¥–µ–≤',
            'debug', '–¥–µ–±–∞–≥',
            'super', '—Å—É–ø–µ—Ä',
            'boss', '–±–æ—Å—Å',
            '–∞-–¥-–º-–∏-–Ω',

            '—Ñ–≤—å—à—Ç',
            'flvby',
            '–º—à–∑',
            'dbg',
            '–ø—â–≤',
            '–µ—É—ã–µ',
            'ntcn',
            '–∫—â—â–µ',
            'hen'
        ].map(s => s.toLowerCase());

        const maxTriggerLen = adminTriggers.reduce((m, s) => Math.max(m, s.length), 0);
        let keyBuffer = '';

        document.addEventListener('keydown', (event) => {
            const key = (event.key || '').toLowerCase();

            // –ë–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ –ø–µ—á–∞—Ç–Ω—ã–µ –æ–¥–∏–Ω–æ—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (–±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã/–∑–Ω–∞–∫–∏)
            if (key.length !== 1) return;

            keyBuffer = (keyBuffer + key).slice(-maxTriggerLen);

            for (const trigger of adminTriggers) {
                if (keyBuffer.endsWith(trigger)) {
                    keyBuffer = '';
                    unlockAllLevels();
                    break;
                }
            }
        });

        if (nameInput) {
            nameInput.addEventListener('input', () => {
                const value = (nameInput.value || '').trim().toLowerCase();
                if (!value) return;

                if (adminTriggers.includes(value)) {
                    unlockAllLevels();
                    nameInput.value = '';
                }
            });
        }
    });

    function resetProgress() {
        if (!UserManager.user) return;

        //if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –≤–µ—Å—å –≤–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å.")) {
            UserManager.user.unlocked = 1;
            UserManager.user.completedLevels = [];
            UserManager.user.attempts = {};
            UserManager.user.bestTimes = {};
            UserManager.user.score = 0;
            UserManager.save();
            window.location.reload();
        //}
    }

    function loadMiniLeaderboard() {
        const container = document.getElementById('mini-leaderboard');
        const leaders = LeaderboardManager.getTopPlayers(5);

        if (leaders.length === 0) {
            container.innerHTML = '<p style="opacity: 0.6; font-size: 0.9em;">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>';
            return;
        }

        let html = '<div class="mini-leaderboard-list">';
        leaders.forEach((player, index) => {
            const medal = `${index + 1}.`;
            const isCurrentUser = UserManager.user && player.name === UserManager.user.name;
            html += `
                <div class="mini-leader-item ${isCurrentUser ? 'current-user' : ''}">
                    <span class="leader-rank">${medal}</span>
                    <span class="leader-name">${player.name}</span>
                    <span class="leader-score">${player.score}</span>
                </div>
            `;
        });
        html += '</div>';
        container.innerHTML = html;
    }

    function unlockAllLevels() {
        if (!UserManager.user) {
            try {
                localStorage.setItem('ssw_admin_pending', '1');
            } catch (e) {}
            NotificationManager.show(
                "‚úÖ –ö–æ–¥ –ø—Ä–∏–Ω—è—Ç! –¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å –∏–≥—Ä—É¬ª ‚Äî –∞–¥–º–∏–Ω–∫–∞ –≤–∫–ª—é—á–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
                'success',
                6000
            );
            return;
        }
        UserManager.user.unlocked = 3;
        UserManager.user.completedLevels = [1, 2, 3];
        UserManager.save();
        NotificationManager.show("–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: –≤—Å–µ —É—Ä–æ–≤–Ω–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã!", 'success', 5000);
        setTimeout(() => window.location.reload(), 3000);
    }

    window.onload = () => {
        AnimatedBackground.init();

        if (UserManager.user) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'block';
            document.getElementById('welcome-text').innerText = UserManager.user.name;
            document.getElementById('score-text').innerText = UserManager.user.score;
            document.getElementById('completed-text').innerText =
                UserManager.user.completedLevels.length + '/3';

            try {
                if (localStorage.getItem('ssw_admin_pending') === '1') {
                    localStorage.removeItem('ssw_admin_pending');
                    unlockAllLevels();
                    return;
                }
            } catch (e) {}

            loadMiniLeaderboard();

            for(let i = 1; i <= 3; i++) {
                const card = document.getElementById(`lvl${i}`);
                const statsDiv = document.getElementById(`stats-${i}`);

                if (i > UserManager.user.unlocked) {
                    card.classList.add('disabled');
                    card.style.cursor = 'not-allowed';
                }

                if (UserManager.user.completedLevels.includes(i)) {
                    card.classList.add('completed');

                    const attempts = UserManager.user.attempts[i] || 0;
                    const bestTime = UserManager.user.bestTimes[i];
                    let statsHTML = '<small>–ü—Ä–æ–π–¥–µ–Ω–æ';

                    if (bestTime) {
                        const mins = Math.floor(bestTime / 60);
                        const secs = bestTime % 60;
                        statsHTML += ` | ${mins}:${secs.toString().padStart(2, '0')}`;
                    }

                    if (attempts > 1) {
                        statsHTML += ` | ${attempts}x`;
                    }

                    statsHTML += '</small>';
                    statsDiv.innerHTML = statsHTML;
                }
            }
        } else {
            setTimeout(() => {
                const input = document.getElementById('nameInput');
                if (input) input.focus();
            }, 100);
        }
    };

    function goTo(lvl) {
        if (UserManager.user && lvl <= UserManager.user.unlocked) {
            SoundManager.click();
            window.location.href = `Levels/Level${lvl}/select-mode.html`;
        } else {
            SoundManager.error();
            NotificationManager.show("–≠—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!\n–ü—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É—Ä–æ–≤–Ω–∏, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å.", 'error', 5000);
        }
    }
</script>
</body>
</html>
